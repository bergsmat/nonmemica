<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Tim Bergsma" />

<meta name="date" content="2023-05-09" />

<title>Creating a Nonmem Parameter Table</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Creating a Nonmem Parameter Table</h1>
<h4 class="author">Tim Bergsma</h4>
<h4 class="date">2023-05-09</h4>



<p>The impact of a great model depends a lot on how well it is
communicated. A parameter table can help; it brings together critical
details of the model in a systematic way. However, creating parameter
tables can be tedious, especially for modeling systems like
<code>NONMEM</code> where information is distributed among numerous text
files. Here we describe a systematic approach for generating parameter
tables in <code>NONMEM</code>.</p>
<div id="sources" class="section level2">
<h2>Sources</h2>
<p>NONMEM results end up in many places.</p>
<ul>
<li><p>The <code>list</code> file has the final parameter estimates in a
readable form, as well as many diagnostic values, such as standard
errors (when available) and shrinkage estimates.</p></li>
<li><p>Various ancillary outputs may be available, such as
<code>*.ext</code>, <code>*.cov</code>, <code>*.xml</code>, etc, giving
more regular and/or more specific versions of model components.</p></li>
<li><p>Bootstrap estimates of parameter uncertainty are probably in some
third-party format, since bootstrapping is usually performed
independently of model estimation.</p></li>
</ul>
<p>Some of the most important information may not be captured anywhere!
You may know that THETA1 is “apparent oral clearance” in your model, and
that the units are liters. But to NONMEM it is just THETA1.</p>
<p>When you are making parameter tables by hand, no problem: your memory
supplies all the integration, as well as missing details. But manual
table generation can be tedious, time-consuming, and error-prone. If,
rather, we want to automate the generation of parameter tables, we’re
going to have to be more systematic about where and how the data sources
are stored.</p>
</div>
<div id="conventions" class="section level2">
<h2>Conventions</h2>
<p>The most fundamental storage convention is the concept of a
<code>project</code>. This is a path – preferably a <em>relative</em>
path, to a directory where your models live.</p>
<p>A second useful convention is the habit of keeping all the files
related to a specific model in a <code>project</code> subdirectory with
a unique name: i.e., the name of the model. While not strictly
necessary, it really helps with organization and keeps NONMEM models
from interfering with eachother while running.</p>
<p>I mentioned relative paths above. Relative to what? A third useful
convention is to write all file paths relative to the file in which you
are writing them. So if I have a model in
<code>home/project/1001/</code>, and I write a script
<code>home/script/analysis.R</code> that processes model ouptut, the
path to the model directory will be written as
<code>../project/1001</code>.</p>
</div>
<div id="challenges" class="section level2">
<h2>Challenges</h2>
<p>Okay, cut to the chase: we want an R function that creates a NONMEM
parameter table. The challenges to be solved are as follows.</p>
<ul>
<li>Where can we find the model output?</li>
<li>What form of the results is required?</li>
<li>Where will the bootstrap values come from?</li>
<li>What is the interpretation of the estimates?</li>
</ul>
</div>
<div id="solution" class="section level2">
<h2>Solution</h2>
<p>The package <code>nonmemica</code> provides the function
<code>partab</code> that creates a parameter table for a single NONMEM
model. <code>partab</code> knows where the models live, because you
explicitly pass a <code>project</code> argument or (if you are lazy like
me) you set an option near the top of your script.</p>
<p>Install and load <code>nonmemica</code> like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;nonmemica&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nonmemica)</span></code></pre></div>
<p>Specify the project directory like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>, <span class="at">project=</span><span class="st">&#39;../model&#39;</span>)</span></code></pre></div>
<p>Or this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">project =</span> <span class="st">&#39;../model&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>)</span></code></pre></div>
</div>
<div id="a-word-about-object-orientation" class="section level2">
<h2>A Word about Object Orientation</h2>
<p>Users should not have to worry much about object orientation, but
knowing something about it can be very helpful.</p>
<p>Briefly, object orientation means that a function does different
things to different object types. Preparing a meal is very different
from preparing a tax return. And formatting a <code>data.frame</code> is
very different from formatting a <code>POSIXlt</code>. Try</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(format)</span></code></pre></div>
<p>to see all ways things get formatted in R. Typically we just say
<code>format</code> and R finds the right method, depending on what it
is we are formatting.</p>
<p><code>partab</code> is no different. If you say
<code>partab(1001)</code>, the software sees that you are trying to
create a parameter table from a number, which doesn’t really make sense.
So it assumes 1001 is a model name, converts it to character, and goes
looking for the function <code>partab.character()</code>. In fact, most
of the interesting arguments to <code>partab</code> are actually
documented under <code>partab.character</code> for this reason.</p>
</div>
<div id="a-word-about-piping" class="section level2">
<h2>A Word about Piping</h2>
<p>You’ve probably noticed … R usage is undergoing a revolution. The
<code>magrittr</code> package recently gave us a “forward pipe operator”
that fundamentally changes how R can be used. Even if you don’t use
piping, an awareness will help you understand the occasional example.
For instance, the following have the same meaning.</p>
<p>Traditional:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>)</span></code></pre></div>
<p>Piped:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> partab</span></code></pre></div>
<p>Essentially, the left-hand-side is the first argument to the function
on the right-hand-side, and the result can be used as input to
yet-another-function in an ongoing chain. That means we can express
functionality in a natural order, rather than reverse-nested order.
This:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">%&gt;%</span> sqrt <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="dv">3</span>)</span></code></pre></div>
<p>is easier to write and easier to understand (in my opinion) than
this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(<span class="fu">sqrt</span>(<span class="dv">2</span>),<span class="at">digits=</span><span class="dv">3</span>)</span></code></pre></div>
<p>but the two are equivalent.</p>
</div>
<div id="finding-estimates" class="section level2">
<h2>Finding Estimates</h2>
<p><code>partab</code> gets estimates and standard errors from
<code>*.xml</code>. Make sure your NONMEM execution procedure calls for
this file to be created and returned. It should appear in the model
directory as a sibling of <code>*.lst</code>. If your xml file is in an
unusual place, you can specify the path explicitly using the
<code>xmlfile</code> argument (othewise <code>partab</code> will
guess).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>, <span class="at">xmlfile=</span><span class="st">&#39;..model/1001.xml&#39;</span>)</span></code></pre></div>
</div>
<div id="finding-bootstraps" class="section level2">
<h2>Finding Bootstraps</h2>
<p><code>partab</code> gets bootstrap estimates from
<code>bootstrap_dirx/bootstrap_results.csv</code> (in the model
directory). This is created using PsN. <code>partab</code> will try to
find the latest file if there are more than one. You can specify the
path explicitly using the <code>bootcsv</code> argument.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>, <span class="at">bootcsv=</span><span class="st">&#39;..model/1001/bootstrap_results.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="finding-metadata" class="section level2">
<h2>Finding Metadata</h2>
<p>Let’s face it. NONMEM does not have integrated metadata. It knows the
final estimate of THETA1, but it does not know what THETA1 means in
human terms. A really useful parameter table should give a symbolic
interpretation of THETA1, such as CL/F, units (if any), and hopefully a
short definition.</p>
<p>The bad news is: you have to supply these yourself. The good new is:
if you do it systematically, you can save a lot of effort.</p>
<p><code>partab</code> looks in two places for metadata. First, it looks
in the control stream for the items mentioned in the <code>fields</code>
argument. It will guess where the control stream is, but you can supply
the <code>ctlfile</code> argument. You can also modify the fields
argument to change what it seeks.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>, <span class="at">ctlfile =</span> <span class="st">&#39;../models/1001.ctl&#39;</span>,<span class="at">fields =</span> <span class="fu">c</span>(<span class="st">&#39;symbol&#39;</span>,<span class="st">&#39;label&#39;</span>,<span class="st">&#39;unit&#39;</span>)).</span></code></pre></div>
<p><code>partab</code> hopes to find each parameter on a line by itself,
with semicolon-delimited fields trailing on the same line.</p>
<pre><code>$THETA 
(0,10,50)     ; CL/F; clearance;       L/h
(0,10,100)    ; Vc/F; central volume;  L
(0,0.2,5)     ; Ka;   absorption rate; 1/h</code></pre>
<p>By the way, the same conventions apply to tabled items. You can
specify in your control stream how you think about table output.</p>
<pre><code>$TABLE NOPRINT FILE=mod2.tab ONEHEADER 
ID            ; ID;    subject identifier;
TIME          ; TIME;  time;                       h
IPRE          ; IPRED; individual prediction;      ng/mL
CL            ; CLI;   posthoc systemic clearance; L/h
ETA1          ; BSV_CL; clearance variability;</code></pre>
<p>Of course, these won’t show up in a parameter table, but you’ll see
them in a list of item definitions if you do this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nonmemica)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">project =</span> <span class="fu">system.file</span>(<span class="st">&#39;project/model&#39;</span>,<span class="at">package=</span><span class="st">&#39;nonmemica&#39;</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> definitions <span class="sc">%&gt;%</span> head</span></code></pre></div>
<pre><code>##       item symbol                        label unit
## 1 theta_01   CL/F                    clearance  L/h
## 2 theta_02   Vc/F               central volume    L
## 3 theta_03     Ka     absorption rate constant  1/h
## 4 theta_04    Q/F intercompartmental clearance  L/h
## 5 theta_05   Vp/F            peripheral volume    L
## 6 theta_06  WT_CL   weight effect on clearance &lt;NA&gt;</code></pre>
<p>If you like, you can write out the defintions and edit them. You can
change the file location or stick with the default. If you didn’t like
exactly what was in the control stream, you can ignore it by passing a
zero-length argument for ctlfile.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> <span class="fu">definitions</span>(<span class="at">write=</span>T)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> <span class="fu">partab</span>(<span class="at">ctlfile =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>The metafile needs to stay comma-separated. White space will be
stripped, and blanks, spaces, or dots will be understood as NA.</p>
</div>
<div id="customizing-your-parameter-table" class="section level2">
<h2>Customizing Your Parameter Table</h2>
<p>By default, the parameter table looks like this (but if bootstraps
can’t be found, the <code>ci</code> columm will be missing).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>)</span></code></pre></div>
<pre><code>##      parameter estimate prse                 ci   symbol
## 1     theta_01     9.51 9.67       (7.24, 11.2)     CL/F
## 2     theta_02     22.8 9.54       (19.7, 25.4)     Vc/F
## 3     theta_03   0.0714 7.35   (0.0646, 0.0803)       Ka
## 4     theta_04     3.47 15.4       (3.02, 4.59)      Q/F
## 5     theta_05      113   21        (90.5, 380)     Vp/F
## 6     theta_06     1.19 28.3        (0.88, 1.3)    WT_CL
## 7     theta_07     1.02   11       (0.53, 1.73)  MALE_CL
## 8  omega_01_01    0.214 22.8     (0.151, 0.319)   IIV_CL
## 9  omega_02_01    0.121 26.4                        CL_V
## 10 omega_02_02   0.0945 33.2      (0.07, 0.179)   IIV_Vc
## 11 omega_03_01  -0.0116  173                       CL_Ka
## 12 omega_03_02  -0.0372 36.1                       Vc_Ka
## 13 omega_03_03   0.0466 34.7    (0.0475, 0.146)   IIV_Ka
## 14 sigma_01_01   0.0492 10.9   (-0.039, 0.0165) ERR_PROP
## 15 sigma_02_02    0.202 33.5 (-0.0512, -0.0097)  ERR_ADD
##                                            label unit
## 1                                      clearance  L/h
## 2                                 central volume    L
## 3                       absorption rate constant  1/h
## 4                   intercompartmental clearance  L/h
## 5                              peripheral volume    L
## 6                     weight effect on clearance &lt;NA&gt;
## 7                       male effect on clearance &lt;NA&gt;
## 8       interindividual variability on clearance &lt;NA&gt;
## 9    interindividual clearance-volume covariance &lt;NA&gt;
## 10 interindividual variability on central volume &lt;NA&gt;
## 11       interindividual clearance-Ka covariance &lt;NA&gt;
## 12          interindividual volume-Ka covariance &lt;NA&gt;
## 13             interindividual variability on Ka &lt;NA&gt;
## 14                            proportional error &lt;NA&gt;
## 15                                additive error &lt;NA&gt;</code></pre>
<p>If you want to modify the table, save it first.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">partab</span>(<span class="dv">1001</span>)</span></code></pre></div>
<p>For better debugging information, set
<code>verbose = TRUE</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partab</span>(<span class="dv">1001</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><code>partab</code> uses global options <code>project</code> and
<code>nested</code> to guess where the run directory is, and uses that
to guess where the source files are (<code>metafile</code>,
<code>xmlfile</code>,<code>ctlfile</code>,<code>bootcsv</code>). You can
supply any of these directly.</p>
<p>By default, <code>partab</code> grabs the 5th and 95th percentile of
bootstraps as <code>lo</code> and <code>hi</code>, but you can specify
other levels using the like-named arguments. <code>partab</code> formats
these and other numerics as character(unless you say
<code>format = F</code>), first limiting to the number of significant
digits you specify (default <code>digits = 3</code>). If
<code>ci = TRUE</code> (the default), <code>lo</code> and
<code>hi</code> will be combined into a single interval using the
default values for <code>open</code>, <code>sep</code>, and
<code>close</code>. Also, you can get absolute standard errors by
setting <code>relative = FALSE</code>. Let’s compare the default table
above with something a bit more “raw”.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> <span class="fu">partab</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> F, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> F, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">relative =</span> F, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="cn">NULL</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##      parameter     estimate           se          lo            hi   symbol
## 1     theta_01   9.50751181  0.919790154  7.23607500  11.165510000     CL/F
## 2     theta_02  22.79071262  2.175293028 19.68059000  25.360120000     Vc/F
## 3     theta_03   0.07143288  0.005249901  0.06458277   0.080336250       Ka
## 4     theta_04   3.47447234  0.535642513  3.01994200   4.586354000      Q/F
## 5     theta_05 113.26550777 23.729595389 90.54828000 380.010800000     Vp/F
## 6     theta_06   1.19214554  0.337188000  0.88016420   1.301607000    WT_CL
## 7     theta_07   1.02437681  0.112446588  0.52951980   1.733120000  MALE_CL
## 8  omega_01_01   0.21385145  0.048857713  0.15135260   0.319490800   IIV_CL
## 9  omega_02_01   0.12075418  0.031922082          NA            NA     CL_V
## 10 omega_02_02   0.09453026  0.031343114  0.06995132   0.179007400   IIV_Vc
## 11 omega_03_01  -0.01162268  0.020065690          NA            NA    CL_Ka
## 12 omega_03_02  -0.03720323  0.013425269          NA            NA    Vc_Ka
## 13 omega_03_03   0.04656332  0.016175082  0.04754577   0.145969600   IIV_Ka
## 14 sigma_01_01   0.04916786  0.005383747 -0.03904045   0.016537490 ERR_PROP
## 15 sigma_02_02   0.20181742  0.067636559 -0.05122678  -0.009697708  ERR_ADD
##                                            label unit
## 1                                      clearance  L/h
## 2                                 central volume    L
## 3                       absorption rate constant  1/h
## 4                   intercompartmental clearance  L/h
## 5                              peripheral volume    L
## 6                     weight effect on clearance &lt;NA&gt;
## 7                       male effect on clearance &lt;NA&gt;
## 8       interindividual variability on clearance &lt;NA&gt;
## 9    interindividual clearance-volume covariance &lt;NA&gt;
## 10 interindividual variability on central volume &lt;NA&gt;
## 11       interindividual clearance-Ka covariance &lt;NA&gt;
## 12          interindividual volume-Ka covariance &lt;NA&gt;
## 13             interindividual variability on Ka &lt;NA&gt;
## 14                            proportional error &lt;NA&gt;
## 15                                additive error &lt;NA&gt;</code></pre>
<p>You may want to do other things as well, such as converting error
estimates to standard deviation or CV%. In my experience, it is
difficult to do this in an automated way, as it depends on hard-to-guess
properties, such as whether your distributions are log normal, and
whether error has been coded as a sigma or a theta. If your goal is
routinely to present random effects next to the corresponding parameter
estimate, consider using the same symbol for each, and then “unstacking”
the data with something like
<code>dplyr:spread(x, parameter, symbol)</code>.</p>
</div>
<div id="rendering-your-parameter-table" class="section level2">
<h2>Rendering Your Parameter Table</h2>
<p>To some extent, the science of creating a parameter table is a
separate issue from the aesthetics. How should you render the table for
viewing by your audience? <code>nonmemica</code> is deliberately
agnostic on this question, since there is no one right answer, and very
many good ones. In an rmarkdown environment, consider
<code>knitr::kable</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> partab <span class="sc">%&gt;%</span> kable</span></code></pre></div>
<table>
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="4%" />
<col width="18%" />
<col width="8%" />
<col width="43%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">parameter</th>
<th align="left">estimate</th>
<th align="left">prse</th>
<th align="left">ci</th>
<th align="left">symbol</th>
<th align="left">label</th>
<th align="left">unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">theta_01</td>
<td align="left">9.51</td>
<td align="left">9.67</td>
<td align="left">(7.24, 11.2)</td>
<td align="left">CL/F</td>
<td align="left">clearance</td>
<td align="left">L/h</td>
</tr>
<tr class="even">
<td align="left">theta_02</td>
<td align="left">22.8</td>
<td align="left">9.54</td>
<td align="left">(19.7, 25.4)</td>
<td align="left">Vc/F</td>
<td align="left">central volume</td>
<td align="left">L</td>
</tr>
<tr class="odd">
<td align="left">theta_03</td>
<td align="left">0.0714</td>
<td align="left">7.35</td>
<td align="left">(0.0646, 0.0803)</td>
<td align="left">Ka</td>
<td align="left">absorption rate constant</td>
<td align="left">1/h</td>
</tr>
<tr class="even">
<td align="left">theta_04</td>
<td align="left">3.47</td>
<td align="left">15.4</td>
<td align="left">(3.02, 4.59)</td>
<td align="left">Q/F</td>
<td align="left">intercompartmental clearance</td>
<td align="left">L/h</td>
</tr>
<tr class="odd">
<td align="left">theta_05</td>
<td align="left">113</td>
<td align="left">21</td>
<td align="left">(90.5, 380)</td>
<td align="left">Vp/F</td>
<td align="left">peripheral volume</td>
<td align="left">L</td>
</tr>
<tr class="even">
<td align="left">theta_06</td>
<td align="left">1.19</td>
<td align="left">28.3</td>
<td align="left">(0.88, 1.3)</td>
<td align="left">WT_CL</td>
<td align="left">weight effect on clearance</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">theta_07</td>
<td align="left">1.02</td>
<td align="left">11</td>
<td align="left">(0.53, 1.73)</td>
<td align="left">MALE_CL</td>
<td align="left">male effect on clearance</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">omega_01_01</td>
<td align="left">0.214</td>
<td align="left">22.8</td>
<td align="left">(0.151, 0.319)</td>
<td align="left">IIV_CL</td>
<td align="left">interindividual variability on clearance</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">omega_02_01</td>
<td align="left">0.121</td>
<td align="left">26.4</td>
<td align="left"></td>
<td align="left">CL_V</td>
<td align="left">interindividual clearance-volume covariance</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">omega_02_02</td>
<td align="left">0.0945</td>
<td align="left">33.2</td>
<td align="left">(0.07, 0.179)</td>
<td align="left">IIV_Vc</td>
<td align="left">interindividual variability on central volume</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">omega_03_01</td>
<td align="left">-0.0116</td>
<td align="left">173</td>
<td align="left"></td>
<td align="left">CL_Ka</td>
<td align="left">interindividual clearance-Ka covariance</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">omega_03_02</td>
<td align="left">-0.0372</td>
<td align="left">36.1</td>
<td align="left"></td>
<td align="left">Vc_Ka</td>
<td align="left">interindividual volume-Ka covariance</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">omega_03_03</td>
<td align="left">0.0466</td>
<td align="left">34.7</td>
<td align="left">(0.0475, 0.146)</td>
<td align="left">IIV_Ka</td>
<td align="left">interindividual variability on Ka</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">sigma_01_01</td>
<td align="left">0.0492</td>
<td align="left">10.9</td>
<td align="left">(-0.039, 0.0165)</td>
<td align="left">ERR_PROP</td>
<td align="left">proportional error</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">sigma_02_02</td>
<td align="left">0.202</td>
<td align="left">33.5</td>
<td align="left">(-0.0512, -0.0097)</td>
<td align="left">ERR_ADD</td>
<td align="left">additive error</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>You can also try <code>pander::pander</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1001</span> <span class="sc">%&gt;%</span> partab <span class="sc">%&gt;%</span> <span class="fu">pander</span>(<span class="at">justify=</span><span class="st">&#39;right&#39;</span>)</span></code></pre></div>
<table style="width:89%;">
<caption>Table continues below</caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="9%" />
<col width="29%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">parameter</th>
<th align="right">estimate</th>
<th align="right">prse</th>
<th align="right">ci</th>
<th align="right">symbol</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">theta_01</td>
<td align="right">9.51</td>
<td align="right">9.67</td>
<td align="right">(7.24, 11.2)</td>
<td align="right">CL/F</td>
</tr>
<tr class="even">
<td align="right">theta_02</td>
<td align="right">22.8</td>
<td align="right">9.54</td>
<td align="right">(19.7, 25.4)</td>
<td align="right">Vc/F</td>
</tr>
<tr class="odd">
<td align="right">theta_03</td>
<td align="right">0.0714</td>
<td align="right">7.35</td>
<td align="right">(0.0646, 0.0803)</td>
<td align="right">Ka</td>
</tr>
<tr class="even">
<td align="right">theta_04</td>
<td align="right">3.47</td>
<td align="right">15.4</td>
<td align="right">(3.02, 4.59)</td>
<td align="right">Q/F</td>
</tr>
<tr class="odd">
<td align="right">theta_05</td>
<td align="right">113</td>
<td align="right">21</td>
<td align="right">(90.5, 380)</td>
<td align="right">Vp/F</td>
</tr>
<tr class="even">
<td align="right">theta_06</td>
<td align="right">1.19</td>
<td align="right">28.3</td>
<td align="right">(0.88, 1.3)</td>
<td align="right">WT_CL</td>
</tr>
<tr class="odd">
<td align="right">theta_07</td>
<td align="right">1.02</td>
<td align="right">11</td>
<td align="right">(0.53, 1.73)</td>
<td align="right">MALE_CL</td>
</tr>
<tr class="even">
<td align="right">omega_01_01</td>
<td align="right">0.214</td>
<td align="right">22.8</td>
<td align="right">(0.151, 0.319)</td>
<td align="right">IIV_CL</td>
</tr>
<tr class="odd">
<td align="right">omega_02_01</td>
<td align="right">0.121</td>
<td align="right">26.4</td>
<td align="right"></td>
<td align="right">CL_V</td>
</tr>
<tr class="even">
<td align="right">omega_02_02</td>
<td align="right">0.0945</td>
<td align="right">33.2</td>
<td align="right">(0.07, 0.179)</td>
<td align="right">IIV_Vc</td>
</tr>
<tr class="odd">
<td align="right">omega_03_01</td>
<td align="right">-0.0116</td>
<td align="right">173</td>
<td align="right"></td>
<td align="right">CL_Ka</td>
</tr>
<tr class="even">
<td align="right">omega_03_02</td>
<td align="right">-0.0372</td>
<td align="right">36.1</td>
<td align="right"></td>
<td align="right">Vc_Ka</td>
</tr>
<tr class="odd">
<td align="right">omega_03_03</td>
<td align="right">0.0466</td>
<td align="right">34.7</td>
<td align="right">(0.0475, 0.146)</td>
<td align="right">IIV_Ka</td>
</tr>
<tr class="even">
<td align="right">sigma_01_01</td>
<td align="right">0.0492</td>
<td align="right">10.9</td>
<td align="right">(-0.039, 0.0165)</td>
<td align="right">ERR_PROP</td>
</tr>
<tr class="odd">
<td align="right">sigma_02_02</td>
<td align="right">0.202</td>
<td align="right">33.5</td>
<td align="right">(-0.0512, -0.0097)</td>
<td align="right">ERR_ADD</td>
</tr>
</tbody>
</table>
<table style="width:56%;">
<colgroup>
<col width="45%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">label</th>
<th align="right">unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">clearance</td>
<td align="right">L/h</td>
</tr>
<tr class="even">
<td align="right">central volume</td>
<td align="right">L</td>
</tr>
<tr class="odd">
<td align="right">absorption rate constant</td>
<td align="right">1/h</td>
</tr>
<tr class="even">
<td align="right">intercompartmental clearance</td>
<td align="right">L/h</td>
</tr>
<tr class="odd">
<td align="right">peripheral volume</td>
<td align="right">L</td>
</tr>
<tr class="even">
<td align="right">weight effect on clearance</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">male effect on clearance</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">interindividual variability on clearance</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">interindividual clearance-volume covariance</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">interindividual variability on central volume</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">interindividual clearance-Ka covariance</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">interindividual volume-Ka covariance</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">interindividual variability on Ka</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">proportional error</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">additive error</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="getting-help" class="section level2">
<h2>Getting Help</h2>
<p>If you have the <code>nonmemica</code> package installed, you can
find this document using
<code>vignette(&#39;parameter-table&#39;, package = &#39;nonmemica&#39;)</code>. Of
course, the usual R help is available as well. Contact the mantainer for
bug fixes and feature requests.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Making a NONMEM parameter table can be tedious. The
<code>nonmemica</code> package provides <code>partab</code>, a flexible
way of assembling the main sources of information and presenting them
nicely. A good parameter table should have rich metadata: symbols,
labels, and units at least. <code>partab</code> supports several options
for encoding metadata systematically.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
